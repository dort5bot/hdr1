Bu kod dosyasÄ± (scheduled_tasks.py), bir asenkron zamanlayÄ±cÄ± (scheduler) kullanarak belirli aralÄ±klarla bazÄ± gÃ¶revleri otomatik olarak Ã§alÄ±ÅŸtÄ±rmak iÃ§in yazÄ±lmÄ±ÅŸtÄ±r. Kodun amacÄ±, bir Telegram botu gibi Ã§alÄ±ÅŸan bir uygulamada:
ğŸ”§ Temel GÃ¶revler
1. E-posta kontrolÃ¼ (scheduled_email_check)
Belirli aralÄ±klarla gelen e-postalarÄ± kontrol eder.
Yeni ekli Excel dosyalarÄ± varsa, admin kullanÄ±cÄ±larÄ±na (Telegram Ã¼zerinden) mesaj gÃ¶nderir.
2. GeÃ§ici dosya temizliÄŸi (scheduled_cleanup)
Her gÃ¼n saat 23:59'da, geÃ§ici dosyalarÄ± temizler.
ğŸ“Œ FonksiyonlarÄ±n AÃ§Ä±klamalarÄ±
âœ… scheduled_email_check(bot)
email_utils.check_email() fonksiyonunu Ã§aÄŸÄ±rarak yeni gelen e-postalarÄ± kontrol eder.
Yeni ekli dosyalar varsa, ADMIN_IDS listesindeki her bir admin'e bir mesaj gÃ¶nderir.
Hatalar log'a yazÄ±lÄ±r.
âœ… scheduled_cleanup()
file_utils.cleanup_temp() fonksiyonu ile geÃ§ici dosyalarÄ± siler.
Hatalar log'a yazÄ±lÄ±r.
âœ… schedule_email_check(bot) ve schedule_cleanup()
YukarÄ±daki gÃ¶revleri asyncio.create_task() ile zamanlayÄ±cÄ±ya uygun ÅŸekilde Ã§alÄ±ÅŸtÄ±rmak iÃ§in sarÄ±cÄ± fonksiyonlardÄ±r (wrapper).
BÃ¶ylece gÃ¶revler bloklamadan arka planda Ã§alÄ±ÅŸÄ±r.
âœ… scheduler(bot)
aioschedule kÃ¼tÃ¼phanesi ile zamanlama yapÄ±lÄ±r:
Her 10 dakikada bir e-posta kontrolÃ¼ yapÄ±lÄ±r.
Her gÃ¼n saat 23:59'da geÃ§ici dosya temizliÄŸi yapÄ±lÄ±r.
Bu gÃ¶revleri sÃ¼rekli olarak Ã§alÄ±ÅŸtÄ±rmak iÃ§in sonsuz dÃ¶ngÃ¼ iÃ§inde aioschedule.run_pending() kullanÄ±lÄ±r.
ğŸ§  KullanÄ±m Senaryosu
Bu kod genellikle bir Telegram botunun parÃ§asÄ± olarak arka planda Ã§alÄ±ÅŸÄ±r ve:
DÃ¼zenli olarak e-posta kutusunu kontrol eder,
Yeni gelen Excel dosyalarÄ±nÄ± tespit edip admin'lere bildirir,
Her gÃ¼n geÃ§ici dosyalarÄ± temizleyerek sistemi dÃ¼zenli tutar.
ğŸ§© BaÄŸÄ±mlÄ±lÄ±klar
Kod, ÅŸu modÃ¼llere baÄŸÄ±mlÄ±:
email_utils ve file_utils: E-posta kontrolÃ¼ ve dosya temizliÄŸi iÃ§in Ã¶zel yardÄ±mcÄ± modÃ¼ller.
ADMIN_IDS: Admin kullanÄ±cÄ± IDâ€™lerini iÃ§eren bir liste (config.py iÃ§inden).
aioschedule: Asenkron zamanlama iÃ§in.
asyncio: Asenkron gÃ¶revlerin Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ± iÃ§in.
ğŸ“ Ã–zetle:
Bu dosya, bir Telegram botunun:
Otomatik e-posta kontrolÃ¼,
Dosya temizliÄŸi gibi
Periyodik gÃ¶revlerini zamanlamak ve yÃ¶netmek iÃ§in kullanÄ±lÄ±r.
Ä°stersen, bu kodu nasÄ±l test edeceÄŸini veya nasÄ±l geniÅŸletebileceÄŸini de anlatabilirim.
